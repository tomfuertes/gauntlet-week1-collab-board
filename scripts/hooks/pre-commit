#!/usr/bin/env bash
# Pre-commit hook: runs lint + format check on staged .ts/.tsx files.
# Install: ln -sf ../../scripts/pre-commit.sh .git/hooks/pre-commit
set -euo pipefail

STAGED=$(git diff --cached --name-only --diff-filter=ACMR -- '*.ts' '*.tsx' | grep '^src/' || true)
if [[ -z "$STAGED" ]]; then
  exit 0
fi

echo "pre-commit: checking format + lint on staged files..."

# Check formatting (--check exits non-zero if files would change)
echo "$STAGED" | xargs npx prettier --check 2>&1 || {
  echo ""
  echo "Fix: npm run format && git add -u"
  exit 1
}

# Lint (warnings are OK, errors fail)
npx eslint $STAGED 2>&1 || {
  echo ""
  echo "Fix lint errors before committing."
  exit 1
}
