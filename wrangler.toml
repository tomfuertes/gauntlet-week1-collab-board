send_metrics = false
account_id = "fe43646df25e695ec77f896a1971a7af"
name = "collabboard"
main = "src/server/index.ts"
compatibility_date = "2025-02-01"
compatibility_flags = ["nodejs_compat"]

[assets]
directory = "dist"

[[d1_databases]]
binding = "DB"
database_name = "collabboard-db"
database_id = "a95ec3ec-693b-4ac9-9cf6-7182cd0cdd0d"

[durable_objects]
bindings = [
  { name = "BOARD", class_name = "Board" },
  { name = "CHAT_AGENT", class_name = "ChatAgent" },
  { name = "SHOW_AGENT", class_name = "ShowAgent" }
]

[[migrations]]
tag = "v1"
new_sqlite_classes = ["Board"]

[[migrations]]
tag = "v2"
new_sqlite_classes = ["ChatAgent"]

[[migrations]]
tag = "v3"
new_sqlite_classes = ["ShowAgent"]

[observability]
enabled = true

[observability.logs]
invocation_logs = true

[ai]
binding = "AI"

[vars]
# Daily AI spend cap in USD (neurons priced at $0.011/1K).
# Tracked per ChatAgent DO instance, resets at midnight UTC.
DAILY_AI_BUDGET_USD = "5.00"
# Workers AI model. Override to test different models without redeploying.
# KEY-DECISION 2026-02-19: GPT-4o Mini default over GLM-4.7-flash - GLM tool calling
# broken in prod, GPT-4o Mini is same cost tier with proven tool reliability.
WORKERS_AI_MODEL = "@cf/zai-org/glm-4.7-flash"
DEFAULT_AI_MODEL = "gpt-4o-mini"
# Langfuse observability (public key + base URL are safe as plaintext vars)
LANGFUSE_PUBLIC_KEY = "pk-lf-683e2ebc-6e3d-4f02-bd85-9d7d67d06a94"
LANGFUSE_BASE_URL = "https://us.cloud.langfuse.com"

# Per-turn quality signal scoring via Haiku judge (off by default - set to "true" to enable)
QUALITY_SIGNAL_ENABLED = "true"

# AUTH_SECRET set via: wrangler secret put AUTH_SECRET
# ANTHROPIC_API_KEY set via: wrangler secret put ANTHROPIC_API_KEY
# OPENAI_API_KEY set via: wrangler secret put OPENAI_API_KEY
# LANGFUSE_SECRET_KEY set via: wrangler secret put LANGFUSE_SECRET_KEY
#   For local dev: add to .dev.vars file
